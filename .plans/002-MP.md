# Custom Domain & Blog Subscription - Master Plan

**Date:** 2025-12-25
**Estimated Total Story Points:** 15

---

## Executive Summary

### What We're Building
Two features: (1) Custom domain configuration (nicharena.com) for GitHub Pages hosting, and (2) email subscription system for blog post notifications using Buttondown.

### Why It Matters
A custom domain provides a professional web presence, while email subscriptions enable reader engagement and audience building without manual outreach.

### Scope
**In:**
- Custom domain DNS configuration (Cloudflare)
- GitHub Pages CNAME setup
- Astro site URL configuration
- Subscribe form UI on blog pages
- Email notifications for new posts only (not updates)
- Basic subscriber count analytics

**Out:**
- RSS feed (could add later)
- Multiple notification channels (SMS, push)
- Advanced analytics (open rates, click tracking)
- Paid email service tiers
- Self-hosted email infrastructure

### Codebase Context
- Static Astro site deployed via GitHub Pages
- Current site URL: `https://niarenaw.github.io`
- Uses `withastro/action@v3` for builds
- Blog posts in `src/content/blog/` with frontmatter schema (title, description, pubDate, updatedDate, draft)
- Styling via Tailwind CSS v4
- Components: Header, Footer, BaseLayout, BlogPostLayout

### Technology Choices
- **GitHub Pages with custom domain** - Free, already in use, supports CNAME
- **Cloudflare** - Domain registrar with free DNS management
- **Buttondown** - Free email newsletter service (up to 100 subscribers), embeddable forms, simple API, tracks subscriber count, respects privacy

### Key Architectural Decisions
1. **Buttondown over Mailchimp/ConvertKit** - Simpler, truly free tier, markdown-friendly, no bloat
2. **Embed form vs API integration** - Embed form is simpler, no backend needed for static site
3. **Manual send vs automated** - Manual blog post notifications (you decide when to send), avoids accidental spam on content edits
4. **Subscribe on blog index only** - Single location, not cluttering individual posts

---

## System Architecture

### Architecture Diagram

```
┌─────────────────────────────────────────────────────────────┐
│                    User's Browser                            │
│  ┌─────────────────────────────────────────────────────┐   │
│  │  nicharena.com                                       │   │
│  │  ┌──────────────┐  ┌──────────────┐                 │   │
│  │  │ Blog Pages   │  │ Subscribe    │                 │   │
│  │  │              │  │ Form (embed) │                 │   │
│  │  └──────────────┘  └──────────────┘                 │   │
│  └─────────────────────────────────────────────────────┘   │
└─────────────────────────────────────────────────────────────┘
           │                        │
           │ HTTPS                  │ Form POST
           ▼                        ▼
┌──────────────────────┐   ┌──────────────────────┐
│   GitHub Pages       │   │   Buttondown         │
│   ┌──────────────┐   │   │   ┌──────────────┐   │
│   │ Static Site  │   │   │   │ Subscriber   │   │
│   │ (Astro)      │   │   │   │ Management   │   │
│   └──────────────┘   │   │   └──────────────┘   │
│                      │   │   ┌──────────────┐   │
│   ┌──────────────┐   │   │   │ Email Send   │   │
│   │ CNAME Record │   │   │   │ (manual)     │   │
│   │ → nicharena  │   │   │   └──────────────┘   │
│   │   .com       │   │   │   ┌──────────────┐   │
│   └──────────────┘   │   │   │ Analytics    │   │
└──────────────────────┘   │   │ Dashboard    │   │
                           │   └──────────────┘   │
           ▲               └──────────────────────┘
           │
┌──────────────────────┐
│   Cloudflare         │
│   (Domain Registrar) │
│   ┌──────────────┐   │
│   │ DNS Records  │   │
│   │ A / CNAME    │   │
│   │ (DNS only)   │   │
│   └──────────────┘   │
└──────────────────────┘
```

### Component Descriptions

**Blog Pages:** Static Astro pages served via GitHub Pages at nicharena.com.

**Subscribe Form:** Embedded Buttondown form for email collection, styled to match site design.

**GitHub Pages:** Static hosting with custom domain support via CNAME file.

**Buttondown:** Third-party email service handling subscriptions, storage, and email delivery.

**Cloudflare:** Domain registrar and DNS management for nicharena.com.

---

## Implementation Tickets

### Ticket #1: Purchase Domain & Configure DNS

**Story Points:** 3

**Description:**
Purchase nicharena.com from Cloudflare and configure DNS records to point to GitHub Pages.

**Tasks:**
- Purchase nicharena.com from Cloudflare
- Configure DNS records in Cloudflare dashboard:
  - A records pointing to GitHub Pages IPs (185.199.108-111.153)
  - CNAME record for `www` subdomain pointing to `niarenaw.github.io`
- **Important:** Set all records to "DNS only" mode (gray cloud), NOT "Proxied" (orange cloud) to avoid certificate conflicts with GitHub Pages
- Wait for DNS propagation (can take up to 48 hours, usually faster)
- Verify DNS resolution with `dig` or online tools

**Acceptance Criteria:**
- [ ] Domain nicharena.com purchased and accessible in Cloudflare dashboard
- [ ] A records configured for apex domain (4 IPs) with "DNS only" mode
- [ ] CNAME record configured for www subdomain with "DNS only" mode
- [ ] DNS resolves correctly (verified via `dig nicharena.com`)

**Dependencies:**
- None (foundational ticket)

**Files:**
- None (external configuration)

**Code Guidance:**

DNS records to add in Cloudflare (all set to "DNS only" / gray cloud):
```
Type: A      Name: @    Content: 185.199.108.153    Proxy: DNS only
Type: A      Name: @    Content: 185.199.109.153    Proxy: DNS only
Type: A      Name: @    Content: 185.199.110.153    Proxy: DNS only
Type: A      Name: @    Content: 185.199.111.153    Proxy: DNS only
Type: CNAME  Name: www  Content: niarenaw.github.io Proxy: DNS only
```

---

### Ticket #2: Configure GitHub Pages Custom Domain

**Story Points:** 2

**Description:**
Configure GitHub Pages to serve the site from nicharena.com, including HTTPS enforcement and Astro site configuration.

**Tasks:**
- Add `CNAME` file to repository root containing `nicharena.com`
- Update `astro.config.mjs` site URL to `https://nicharena.com`
- Enable custom domain in GitHub repo settings (Settings → Pages)
- Enable "Enforce HTTPS" once certificate is provisioned
- Verify site loads at new domain with HTTPS

**Acceptance Criteria:**
- [ ] `CNAME` file exists in repo root containing `nicharena.com`
- [ ] `astro.config.mjs` site URL updated to `https://nicharena.com`
- [ ] GitHub Pages shows custom domain configured
- [ ] HTTPS certificate provisioned (may take a few minutes)
- [ ] Site accessible at `https://nicharena.com` and `https://www.nicharena.com`
- [ ] Old `niarenaw.github.io` redirects to new domain

**Dependencies:**
- Ticket #1 (DNS must be configured first)

**Files:**
- `CNAME` (new) - contains `nicharena.com`
- `astro.config.mjs` (modify) - update `site` property

---

### Ticket #3: Create Buttondown Account & Get Embed Code

**Story Points:** 1

**Description:**
Set up Buttondown account for email subscriptions and obtain the embed form code for integration.

**Tasks:**
- Create free Buttondown account at buttondown.email
- Configure newsletter settings (name, description, from address)
- Customize confirmation email (optional)
- Get embed form HTML code from Buttondown dashboard
- Note subscriber dashboard URL for analytics
- Verify whether free tier exposes subscriber count API (for Ticket #5)

**Acceptance Criteria:**
- [ ] Buttondown account created and verified
- [ ] Newsletter name configured
- [ ] Embed form code obtained
- [ ] Test subscription works (subscribe yourself)
- [ ] Note taken on subscriber count API availability

**Dependencies:**
- None (can be done in parallel with Tickets #1-2)

**Files:**
- None (external setup)

---

### Ticket #4: Add Subscribe Form to Blog Index

**Story Points:** 3

**Description:**
Add an email subscription form to the blog index page, styled to match the site's design.

**Tasks:**
- Create `SubscribeForm.astro` component
- Style form to match site design (dark theme, accent colors)
- Add form to blog index page below post list
- Include brief copy explaining what subscribers get
- Test form submission works with Buttondown

**Acceptance Criteria:**
- [ ] Subscribe form component created
- [ ] Form styled consistently with site (colors, fonts, spacing)
- [ ] Form appears on `/blog` page
- [ ] Email input has proper validation (type="email", required)
- [ ] Submit button has hover state
- [ ] Form submits successfully to Buttondown
- [ ] Success state shown after submission (Buttondown handles via redirect)

**Dependencies:**
- Ticket #3 (need Buttondown embed code)

**Files:**
- `src/components/SubscribeForm.astro` (new)
- `src/pages/blog/index.astro` (modify)

**Code Guidance:**

Buttondown embed forms use a simple HTML form POST:
```astro
<form
  action="https://buttondown.email/api/emails/embed-subscribe/nicharena"
  method="post"
  class="..."
>
  <input type="email" name="email" placeholder="your@email.com" required />
  <button type="submit">Subscribe</button>
</form>
```

---

### Ticket #5: Add Subscriber Count Display (Optional)

**Story Points:** 3

**Description:**
Display current subscriber count on the blog page if Buttondown free tier supports it. This ticket is **optional** - skip if API access requires paid tier.

**Tasks:**
- First: Verify Buttondown free tier provides subscriber count (via API or embed)
- If available: fetch count at build time or use public embed
- If not available: either skip ticket or use manual count update
- Style count display to be subtle but visible

**Acceptance Criteria:**
- [ ] Investigated Buttondown free tier capabilities
- [ ] If available: subscriber count displayed near subscribe form
- [ ] Display is subtle (e.g., "Join 5 other readers")
- [ ] Gracefully handles zero subscribers ("Be the first to subscribe")
- [ ] If not available: ticket closed as "won't do" with note

**Dependencies:**
- Ticket #4 (subscribe form must exist)

**Files:**
- `src/components/SubscribeForm.astro` (modify)

---

### Ticket #6: Document New Post Notification Workflow

**Story Points:** 3

**Description:**
Document the workflow for notifying subscribers when a new blog post is published.

**Tasks:**
- Write documentation for the notification workflow
- Include steps to compose email in Buttondown
- Define what triggers a notification (new post only, not edits)
- Add checklist to README

**Acceptance Criteria:**
- [ ] README updated with notification workflow section
- [ ] Clear distinction: new posts = notify, edits = don't notify
- [ ] Steps documented: publish post → compose in Buttondown → send
- [ ] Template email content suggested

**Dependencies:**
- Ticket #3 (Buttondown account must exist)

**Files:**
- `README.md` (modify)

---

## Summary

| Ticket | Title | Points | Dependencies |
|--------|-------|--------|--------------|
| #1 | Purchase Domain & Configure DNS | 3 | None |
| #2 | Configure GitHub Pages Custom Domain | 2 | #1 |
| #3 | Create Buttondown Account & Get Embed Code | 1 | None |
| #4 | Add Subscribe Form to Blog Index | 3 | #3 |
| #5 | Add Subscriber Count Display (Optional) | 3 | #4 |
| #6 | Document Notification Workflow | 3 | #3 |

**Total: 15 Story Points**

**Parallel Work Possible:**
- Tickets #1-2 (domain) can be done in parallel with #3-4-5-6 (subscription)
- Ticket #3 has no dependencies, start immediately
